import"./hoisted.DV8WBEkX.js";let e=1;const t=15;let n,s=0;function a(e,t="info"){const n=document.createElement("div");n.className="fixed top-4 right-4 px-4 py-2 rounded-md text-white z-50 "+("error"===t?"bg-red-600":"success"===t?"bg-green-600":"bg-blue-600"),n.textContent=e,document.body.appendChild(n),setTimeout(()=>n.remove(),3e3)}async function d(e,t={}){try{const n=await fetch(e,t);if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);return await n.json()}catch(n){throw a("Error connecting to API","error"),n}}async function c(){try{const e=await d("/api/security/stats");document.getElementById("criticalCount").textContent=e.critical_alerts||0,document.getElementById("suspiciousCount").textContent=e.suspicious_ips||0,document.getElementById("blockedCount").textContent=e.blocked_ips||0,document.getElementById("totalEvents").textContent=e.total_events||0}catch(e){}}async function i(e=1){try{const n=new URLSearchParams({page:e.toString(),limit:t.toString()}),a=document.getElementById("searchInput").value,c=document.getElementById("dateFilter").value,i=document.getElementById("typeFilter").value,o=document.getElementById("severityFilter").value;a&&n.append("search",a),c&&n.append("date",c),i&&n.append("type",i),o&&n.append("severity",o);const r=await d(`/api/security/logs?${n}`);s=r.total||0,function(e){const t=document.getElementById("logsTableBody");if(0===e.length)return void(t.innerHTML='<tr><td colspan="6" class="text-center py-4 text-gray-500">No logs found</td></tr>');t.innerHTML=e.map(e=>`\n        <tr class="hover:bg-gray-50">\n          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">\n            ${new Date(e.created_at).toLocaleString()}\n          </td>\n          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 font-mono">\n            ${e.ip_address}\n          </td>\n          <td class="px-6 py-4 whitespace-nowrap">\n            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${"login_failed"===e.event_type?"bg-red-100 text-red-800":"login_success"===e.event_type?"bg-green-100 text-green-800":"brute_force"===e.event_type?"bg-orange-100 text-orange-800":"bg-gray-100 text-gray-800"}">\n              ${e.event_type}\n            </span>\n          </td>\n          <td class="px-6 py-4 whitespace-nowrap">\n            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${"critical"===e.severity?"bg-red-100 text-red-800":"high"===e.severity?"bg-orange-100 text-orange-800":"medium"===e.severity?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}">\n              ${e.severity}\n            </span>\n          </td>\n          <td class="px-6 py-4 text-sm text-gray-900 max-w-xs truncate">\n            ${e.message}\n          </td>\n          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">\n            <button onclick="investigateIP('${e.ip_address}')" class="text-blue-600 hover:text-blue-900 mr-2">Investigate</button>\n            <button onclick="blockIP('${e.ip_address}')" class="text-red-600 hover:text-red-900">Block</button>\n          </td>\n        </tr>\n      `).join("")}(r.logs||[]),function(e,n){const s=Math.max(0,(e-1)*t+1),a=Math.min(e*t,n);document.getElementById("showingFrom").textContent=s,document.getElementById("showingTo").textContent=a,document.getElementById("totalCount").textContent=n,document.getElementById("prevPage").disabled=e<=1,document.getElementById("prevPageMobile").disabled=e<=1,document.getElementById("nextPage").disabled=e*t>=n,document.getElementById("nextPageMobile").disabled=e*t>=n}(r.page||1,r.total||0)}catch(n){document.getElementById("logsTableBody").innerHTML='<tr><td colspan="6" class="text-center py-4 text-gray-500">Error loading logs</td></tr>'}}async function o(){try{!function(e){const t=document.getElementById("alertsContainer");if(0===e.length)return void(t.innerHTML='<p class="text-gray-500 text-center py-8">No active alerts</p>');t.innerHTML=e.map(e=>`\n        <div class="border-l-4 ${"critical"===e.severity?"border-red-500":"border-yellow-500"} bg-${"critical"===e.severity?"red":"yellow"}-50 p-4">\n          <div class="flex">\n            <div class="flex-shrink-0">\n              <svg class="h-5 w-5 text-${"critical"===e.severity?"red":"yellow"}-400" viewBox="0 0 20 20" fill="currentColor">\n                <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />\n              </svg>\n            </div>\n            <div class="ml-3">\n              <p class="text-sm font-medium text-gray-900">${e.title}</p>\n              <p class="text-sm text-gray-600">${e.description}</p>\n              <p class="text-xs text-gray-500 mt-1">${new Date(e.timestamp).toLocaleString()}</p>\n            </div>\n          </div>\n        </div>\n      `).join("")}(await d("/api/security/alerts")||[])}catch(e){}}async function r(e){try{!function(e){document.getElementById("investigationContent").innerHTML=`\n        <div class="bg-gray-50 p-4 rounded-lg mb-4">\n          <h4 class="font-semibold text-gray-900 mb-2">IP Address: ${e.ip_address}</h4>\n          <p class="text-sm text-gray-600">Risk Score: <span class="font-bold text-red-600">${e.risk_score}/100</span></p>\n          <p class="text-sm text-gray-600">Total Events: ${e.total_events}</p>\n          <p class="text-sm text-gray-600">Blocked: ${e.is_blocked?"Yes":"No"}</p>\n        </div>\n        \n        <div class="mb-4">\n          <h4 class="font-semibold text-gray-900 mb-2">Recent Events</h4>\n          <div class="space-y-2">\n            ${e.recent_events.map(e=>`\n              <div class="border-l-4 border-gray-200 pl-4">\n                <p class="text-sm font-medium">${e.event_type}</p>\n                <p class="text-xs text-gray-500">${new Date(e.timestamp).toLocaleString()}</p>\n                <p class="text-xs text-gray-600">${e.message}</p>\n              </div>\n            `).join("")}\n          </div>\n        </div>\n        \n        <div class="mb-4">\n          <h4 class="font-semibold text-gray-900 mb-2">Behavior Patterns</h4>\n          <div class="grid grid-cols-2 gap-4">\n            <div>\n              <p class="text-sm text-gray-600">Failed Logins: ${e.failed_logins}</p>\n              <p class="text-sm text-gray-600">Suspicious Activity: ${e.suspicious_activity}</p>\n            </div>\n            <div>\n              <p class="text-sm text-gray-600">Brute Force Attempts: ${e.brute_force_attempts}</p>\n              <p class="text-sm text-gray-600">Last Activity: ${new Date(e.last_activity).toLocaleString()}</p>\n            </div>\n          </div>\n        </div>\n      `}(await d(`/api/security/investigate?ip=${e}`)),document.getElementById("investigateModal").classList.remove("hidden")}catch(t){a("Error investigating IP","error")}}document.getElementById("refreshBtn").addEventListener("click",()=>{c(),i(),o()}),document.getElementById("exportBtn").addEventListener("click",async function(){try{const e=await fetch("/api/security/export"),t=await e.blob(),n=window.URL.createObjectURL(t),s=document.createElement("a");s.href=n,s.download=`security-logs-${(new Date).toISOString().split("T")[0]}.csv`,s.click(),window.URL.revokeObjectURL(n),a("Export completed","success")}catch(e){a("Error exporting logs","error")}}),document.getElementById("clearLogsBtn").addEventListener("click",function(){document.getElementById("clearModal").classList.remove("hidden")}),document.getElementById("investigateBtn").addEventListener("click",()=>{const e=prompt("Enter IP address to investigate:");e&&r(e)}),document.getElementById("cancelBlock").addEventListener("click",()=>{document.getElementById("blockModal").classList.add("hidden")}),document.getElementById("confirmBlock").addEventListener("click",async function(){const e=document.getElementById("blockIpInput").value,t=document.getElementById("blockReason").value;if(e&&t)try{await d("/api/security/block-ip",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ip_address:e,reason:t,expires_at:null})}),a("IP blocked successfully","success"),document.getElementById("blockModal").classList.add("hidden"),c(),i()}catch(n){a("Error blocking IP","error")}else a("Please fill in all fields","error")}),document.getElementById("closeInvestigate").addEventListener("click",()=>{document.getElementById("investigateModal").classList.add("hidden")}),document.getElementById("cancelClear").addEventListener("click",()=>{document.getElementById("clearModal").classList.add("hidden")}),document.getElementById("confirmClear").addEventListener("click",async function(){try{await d("/api/security/clear-logs",{method:"DELETE",headers:{"Content-Type":"application/json"}}),a("Logs cleared successfully","success"),document.getElementById("clearModal").classList.add("hidden"),c(),i()}catch(e){a("Error clearing logs","error")}}),document.getElementById("searchInput").addEventListener("input",()=>i(1)),document.getElementById("dateFilter").addEventListener("change",()=>i(1)),document.getElementById("typeFilter").addEventListener("change",()=>i(1)),document.getElementById("severityFilter").addEventListener("change",()=>i(1)),document.getElementById("prevPage").addEventListener("click",()=>{e>1&&(e--,i(e))}),document.getElementById("nextPage").addEventListener("click",()=>{e*t<s&&(e++,i(e))}),document.getElementById("prevPageMobile").addEventListener("click",()=>{e>1&&(e--,i(e))}),document.getElementById("nextPageMobile").addEventListener("click",()=>{e*t<s&&(e++,i(e))}),document.addEventListener("DOMContentLoaded",()=>{c(),i(),o(),n&&clearInterval(n),n=setInterval(()=>{c(),i(),o()},3e4)}),window.addEventListener("beforeunload",()=>{n&&clearInterval(n)});
