import"./hoisted.DV8WBEkX.js";const e="/api/security";let t=1,n=1;async function o(e,t={}){try{const n=await fetch(e,t);if(!n.ok){const e=await n.json().catch(()=>({error:"Erro desconhecido na API"}));throw new Error(e.error||`Erro ${n.status}`)}return n.json()}catch(n){throw p(`Erro: ${n.message}`,"error"),n}}const s=()=>o(`${e}/stats`),d=(t=1,n=15,s={})=>{const d=new URLSearchParams({page:String(t),limit:String(n),...s.search&&{search:s.search},...s.date&&{startDate:s.date},...s.type&&{type:s.type}});return o(`${e}/logs?${d}`)},a=t=>o(`${e}/block-ip`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ip:t})}),i=()=>o(`${e}/clear-logs`,{method:"DELETE"}),r=t=>o(`${e}/investigate?ip=${t}`),l=()=>{window.location.href=`${e}/export`};async function c(){try{!function(e){document.getElementById("stats-section").innerHTML=`\n        <div class="bg-white p-5 rounded-xl shadow-md flex items-center justify-between">\n            <div>\n                <p class="text-sm font-medium text-gray-500">Total de Logs</p>\n                <p class="text-2xl font-bold text-gray-900">${e.total_security_logs}</p>\n            </div>\n            <div class="bg-blue-100 text-blue-600 p-3 rounded-full">\n                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>\n            </div>\n        </div>\n        <div class="bg-white p-5 rounded-xl shadow-md flex items-center justify-between">\n            <div>\n                <p class="text-sm font-medium text-gray-500">Logins Bem-sucedidos</p>\n                <p class="text-2xl font-bold text-green-600">${e.auth_attempts.successful}</p>\n            </div>\n            <div class="bg-green-100 text-green-600 p-3 rounded-full">\n                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>\n            </div>\n        </div>\n        <div class="bg-white p-5 rounded-xl shadow-md flex items-center justify-between">\n            <div>\n                <p class="text-sm font-medium text-gray-500">Falhas de Login</p>\n                <p class="text-2xl font-bold text-red-600">${e.auth_attempts.failed}</p>\n            </div>\n            <div class="bg-red-100 text-red-600 p-3 rounded-full">\n                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>\n            </div>\n        </div>\n        <div class="bg-white p-5 rounded-xl shadow-md flex items-center justify-between">\n            <div>\n                <p class="text-sm font-medium text-gray-500">IPs Suspeitos</p>\n                <p class="text-2xl font-bold text-yellow-600">${e.top_suspicious_ips.length}</p>\n            </div>\n            <div class="bg-yellow-100 text-yellow-600 p-3 rounded-full">\n                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>\n            </div>\n        </div>\n    `}(await s())}catch(e){}}async function m(){const e={search:document.getElementById("search-input").value,date:document.getElementById("date-filter").value,type:document.getElementById("type-filter").value};try{const o=await d(t,15,e);!function(e){const t=document.getElementById("logs-table-body");0!==e.length?t.innerHTML=e.map(e=>`\n        <tr class="hover:bg-gray-50">\n            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">${new Date(e.created_at).toLocaleString("pt-BR")}</td>\n            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-800">${e.event_type}</td>\n            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600 font-mono">${e.ip_address}</td>\n            <td class="px-6 py-4 text-sm text-gray-600 truncate max-w-xs">${e.details}</td>\n            <td class="px-6 py-4 whitespace-nowrap text-center text-sm font-medium">\n                <button class="text-blue-600 hover:text-blue-800" onclick="handleInvestigate('${e.ip_address}')">Investigar</button>\n                <button class="text-red-600 hover:text-red-800 ml-4" onclick="handleBlockIp('${e.ip_address}')">Bloquear</button>\n            </td>\n        </tr>\n    `).join(""):t.innerHTML='<tr><td colspan="5" class="text-center py-10 text-gray-500">Nenhum registro encontrado.</td></tr>'}(o.logs),n=o.totalPages,document.getElementById("pagination-controls").innerHTML=`\n        <p class="text-sm text-gray-600">Página ${t} de ${n}</p>\n        <div class="flex space-x-2">\n            <button id="prev-page" class="px-3 py-1 bg-gray-200 rounded-md hover:bg-gray-300" ${1===t?"disabled":""}>Anterior</button>\n            <button id="next-page" class="px-3 py-1 bg-gray-200 rounded-md hover:bg-gray-300" ${t===n?"disabled":""}>Próxima</button>\n        </div>\n    `,document.getElementById("prev-page")?.addEventListener("click",()=>{t>1&&(t--,m())}),document.getElementById("next-page")?.addEventListener("click",()=>{t<n&&(t++,m())})}catch(o){document.getElementById("logs-table-body").innerHTML='<tr><td colspan="5" class="text-center py-10 text-red-500">Falha ao carregar os logs.</td></tr>'}}function u(){g("Limpar Logs","Tem certeza de que deseja limpar TODOS os logs de segurança? Esta ação é irreversível.","Limpar Tudo","bg-red-800 hover:bg-red-900",async()=>{try{await i(),p("Todos os logs foram limpos.","success"),t=1,m(),c()}catch(e){}})}function g(e,t,n,o,s){const d=document.getElementById("confirmation-modal");document.getElementById("modal-title").textContent=e,document.getElementById("modal-message").textContent=t;const a=document.getElementById("modal-confirm-button");a.textContent=n,a.className=`px-4 py-2 text-white rounded-lg ${o}`;const i=()=>{d.classList.add("hidden"),s(),a.removeEventListener("click",i)};a.addEventListener("click",i),d.classList.remove("hidden"),d.classList.add("flex")}function p(e,t="info"){const n=document.createElement("div"),o="success"===t?"bg-green-600":"error"===t?"bg-red-600":"bg-blue-600";n.className=`fixed bottom-5 right-5 text-white px-6 py-3 rounded-lg shadow-lg ${o} z-50`,n.textContent=e,document.body.appendChild(n),setTimeout(()=>{n.remove()},3e3)}document.getElementById("modal-cancel-button").addEventListener("click",()=>{document.getElementById("confirmation-modal").classList.add("hidden")}),document.getElementById("investigation-close-button").addEventListener("click",()=>{document.getElementById("investigation-modal").classList.add("hidden")}),window.handleInvestigate=async function(e){try{!function(e,t){const n=document.getElementById("investigation-modal");document.getElementById("investigation-ip").textContent=e;document.getElementById("investigation-content").innerHTML=`\n        <h4 class="font-bold mt-4">Comportamento do Usuário</h4>\n        <pre class="bg-gray-100 p-2 rounded-md text-sm">${JSON.stringify(t.user_behavior,null,2)}</pre>\n        <h4 class="font-bold mt-4">Logs de Segurança Recentes</h4>\n        <pre class="bg-gray-100 p-2 rounded-md text-sm">${JSON.stringify(t.recent_logs,null,2)}</pre>\n    `,n.classList.remove("hidden"),n.classList.add("flex")}(e,await r(e))}catch(t){}},window.handleBlockIp=function(e){g("Bloquear IP",`Tem certeza de que deseja bloquear o IP ${e}? Esta ação impedirá qualquer acesso futuro deste endereço.`,"Bloquear","bg-red-600 hover:bg-red-700",async()=>{try{await a(e),p(`IP ${e} bloqueado com sucesso.`,"success"),m()}catch(t){}})},document.addEventListener("DOMContentLoaded",function(){c(),m(),async function(){try{const e=await fetch("/api/security/logs?limit=1000"),t=await e.json(),n=[...new Set(t.logs.map(e=>e.event_type))].sort();document.getElementById("type-filter").innerHTML='<option value="">Todos os Tipos</option>'+n.map(e=>`<option value="${e}">${e}</option>`).join("")}catch(e){}}(),document.getElementById("refresh-button").addEventListener("click",()=>{c(),m(),p("Dados atualizados.","info")}),document.getElementById("filter-button").addEventListener("click",()=>{t=1,m()}),document.getElementById("search-input").addEventListener("input",e=>{clearTimeout(window.searchTimeout),window.searchTimeout=setTimeout(()=>{t=1,m()},500)}),document.getElementById("date-filter").addEventListener("change",()=>{t=1,m()}),document.getElementById("type-filter").addEventListener("change",()=>{t=1,m()}),document.getElementById("clear-logs-button").addEventListener("click",u),document.getElementById("export-csv-button").addEventListener("click",l),document.getElementById("last-updated").textContent=`Atualizado: ${(new Date).toLocaleTimeString("pt-BR")}`,setInterval(()=>{document.getElementById("last-updated").textContent=`Atualizado: ${(new Date).toLocaleTimeString("pt-BR")}`},6e4)});
